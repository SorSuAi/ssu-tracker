<!DOCTYPE html>
<html>
<head>
    <title>SSU Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        button { padding: 20px; margin: 10px; width: 80%; font-size: 1.2em; cursor: pointer; }
        .active { background-color: #4CAF50; color: white; }
    </style>
    <link rel="manifest" href="manifest.json">
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
    </script>
</head>
<body>
    <h2>SSU Attendance & Recitation</h2>
    <p id="status">Tap a mode to start scanning...</p>
    
    <button id="btnAttendance" onclick="setMode('Attendance')">Mode: Attendance</button>
    <button id="btnRecitation" onclick="setMode('Recitation')">Mode: Recitation</button>

    <script>
        let currentMode = "Attendance";
        const scriptURL = "https://script.google.com/macros/s/AKfycbx5sZG0zIJhkB8P6LjKolCrwXXuDzfsrYWU8enK4Ln_cZS9UwcBX__PHLixbYCjnoKJ/exec";

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('status').innerText = "Mode changed to: " + mode;
            if (navigator.vibrate) navigator.vibrate(50); 
        }

        async function startScanning() {
            if ('NDEFReader' in window) {
                try {
                    const ndef = new NDEFReader();
                    await ndef.scan();
                    document.getElementById('status').innerText = "ðŸ“¡ Scanner Active (Center-back of phone)";

                    ndef.onreading = event => {
                        // event.serialNumber is a unique ID for every NFC card
                        const id = event.serialNumber;
                        logToSheet(id);
                    };
                } catch (error) {
                    document.getElementById('status').innerText = "Error: " + error;
                }
            } else {
                alert("Web NFC not supported. Use Chrome on Android.");
            }
        }

        function logToSheet(id) {
            fetch(`${scriptURL}?id=${id}&type=${currentMode}`)
                .then(() => {
                    document.getElementById('status').innerHTML = 
                        `<b style="color: green;">Logged ${currentMode}</b><br>ID: ${id}`;
                    if (navigator.vibrate) navigator.vibrate([100, 50, 100]); // Success vibration
                })
                .catch(err => alert("Sheet Error: " + err));
        }

        // Initialize on first click
        document.body.addEventListener('click', () => {
            startScanning();
        }, { once: true });
    </script>
</body>
</html>